version: 1.0.{build}
configuration: Debug
environment:
  testspace_token:
    secure: pAI5nNig8Wcc5K2GEiMTx/m5EiwfB+fIZTaTUt0254nLmP3HH/x1BeWAGXa7u2JR
install:
- ps: >-
    mkdir .\money\packages

    mkdir .\money\packages\testspace

    wget https://testspace-runner.s3.amazonaws.com/testspace-windows-latest.zip -outfile .\money\packages\testspace.zip

    7z x .\money\packages\testspace.zip -omoney\packages\testspace
before_build:
- cmd: nuget restore money/cs-money.sln
build:
  project: money/cs-money.sln
  verbosity: minimal
test_script:
- ps: >-
    .\money\packages\OpenCover.4.6.519\tools\OpenCover.Console.exe -target:".\money\packages\NUnit.ConsoleRunner.3.2.1\tools\nunit3-console.exe" -targetargs:'.\money\bin\Debug\cs-money.dll' -output:'.\codecoverage.xml' -register:user


    .\money\packages\testspace\testspace.exe publish .\testresult.xml .\codecoverage.xml ${ENV:testspace_token}:@jschultz.testspace.com/my-project/Nunit


    # upload results to AppVeyor


    $wc = New-Object 'System.Net.WebClient'


    $wc.UploadFile("https://ci.appveyor.com/api/testresults/nunit3/$($env:APPVEYOR_JOB_ID)", (Resolve-Path .\testresult.xml))
